<!DOCTYPE html>
<html lang="da">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>The super duper nice fantastic game!</title>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/general.css">

    <!-- Scripts -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
	<audio id="music" type="audio/mp3" src="Vince--A-Walk.mp3" autoplay loop></audio>
	<audio id="footstep" type="audio/mp3" src="footstepFloor.mp3"></audio>
	<header>
		<div class="container-fluid">
			<h1>The super duper nice fantastic game!</h1>
		</div>
	</header>
	<section class="container-fluid">
		<div class="row">
			<article class="col-md-9">
				<canvas id="game_canvas" onclick="game_canvas()" width="1280" height="720">
					Your browser does not support the HTML5 canvas tag.
				</canvas>
			</article>
			<article class="col-md-3 sidebar">
				<h4>Controls</h4>
				<p>Moving:</p>
				<p>Interacting:</p>
				<h4>Quest log</h4>
				<p><span id="objective">Get out of the classroom.</span></p>
				<p><span id="subjective"></span>
			</article>
		</div>
	</section>
<script>
var canvas = document.getElementById('game_canvas'),
context = canvas.getContext('2d');

posX = 810;
posY = 390;
cutPosX = 0;
cutWidthX = 200;
cutPosY = 0;
var charReset;
var door = 0;
var locationEvent = 'classroom';
var moving = 0;
var units = 0;
var caseNumber = 0;
var roam = 1;
var battle = 0;
var transition = 0;
var transitionX = -1280;
var footstep = document.getElementById('footstep');
var music = document.getElementById('music');
var subjective = document.getElementById("subjective");
var objective = document.getElementById("objective");
var moveSidePos = 0;
var movePos = 0;


base_image = new Image();
base_image.src = 'sprite.png';

background = new Image();
background.src = '../Level Design/ClassRoom.png';

transitionImage = new Image();
transitionImage.src = 'transitionImage.gif';

npc1 = new Image();
var npc1PosX;
var npc1PosY;

npc2 = new Image();
var npc2PosX;
var npc2PosY;

music.volume = 0.1;

document.addEventListener('keydown', updateMovement);
canvas.addEventListener('mousedown', mouseClick);
//window.addEventListener('load', render);
var FPS = 30;
setInterval(function() {
//function render(){

  update();
  draw();
 // window.requestAnimationFrame(render);
//  }
}, 1000/FPS);

function update()
{
	updateAnimation(caseNumber);
	if(roam == 0 && battle == 0)
	{
		transition();
	}
	if(roam == 0 && battle == 1)
	{
		transition = 1;
		//startBattle();
	}
}

function mouseClick(event)
{
	canvasX = event.pageX;
	canvasY = event.pageY;
	if(90<canvasX && canvasX < 146 && 10<canvasY && canvasY<110 && locationEvent == 'classroom')
	{
		// Find key in classroom event.
		alertBox('You found the key!'+canvasX+" "+canvasY);
		door = 1;
		npc2.src = '';
		subjective.innerText = "";
	}
}

function updateMovement(evt)
{
// Flag to put variables back if we hit an edge of the board.
        var flag = 0;
		var restricted = 0;

        // Get where the char was before key process.
        oldCharX = posX;
        oldCharY = posY;

        switch (evt.keyCode) {

		  // Ctrl
        case 17:
          if (posX == 210 && posY == 270 && locationEvent == 'classroom')
		  {
            // If at door, Fire event
			if(door == 1)
			{
				alertBox('You walked out the door using the key.');
				background.src = '../Level Design/HallWay.png';
				locationEvent = 'hallway';
				posX = 150;
				posY = 120;
				npc1.src = 'cleaning_lady.gif';
				npc1PosX = 150;
				npc1PosY = 60;
				subjective.innerText = "Talk to the friendly looking'ish cleaning lady.";
			}
			else
			{
				alertBox('You cant get out. The door is  locked. "HINT: Something sparkles"');
				subjective.innerText = "Find the key.";
				npc2.src = 'sparkles.gif';
				npc2PosX = 85;
				npc2PosY = 50;
			}
          }
		  
		  if(posX == 150 && posY == 90 && locationEvent == 'hallway')
		  {
			alertBox('Cleaning lady yells: "U DO CLEAN!, NOT ME!"');
			roam = 0;
			moving = 1;
			units = 30;
			caseNumber = 200;
		  }
          break;
		
          // Left arrow.
        case 37:
		  if(moving == 0)
		  {
		  moving = 1;
		  units = 60;
          caseNumber = 37;
		  
		  
		  }
          break;
		  

          // Right arrow.
        case 39:
		if(locationEvent == 'classroom')
		{
			//Don't go into trash can
		  if(posX+30 == 120 && posY+30 < 80) {
				flag = 1;
				restricted = 1;
			  }
			  }
		  if(moving == 0 && restricted == 0)
		  {
			moving = 1;
			units = 60;
			caseNumber = 39;
		  }
          break;

          // Down arrow
        case 40:
		  if(moving == 0)
		  {
			moving = 1;
			units = 60;
			caseNumber = 40;
		  }
          break;

          // Up arrow 
        case 38:
		if(locationEvent == 'classroom')
		{
		  if(posY-60 < 60) {
				flag = 1;
				restricted = 1;
			  }
			  }
		if(moving == 0 && restricted == 0)
		  {
			moving = 1;
			units = 60;
			caseNumber = 38;
		  }
          break;

        }

        // If flag is set, the ship did not move.
        // Put everything back the way it was.
        
		
		
      }

function updateAnimation(caseNumbers)
{
	var flag = 0;
	if(units == 60)
	{
		oldCharX = posX;
        oldCharY = posY;
	}
	
	if(units > 0)
	{
		//Left arrow
		if(caseNumbers == 37)
		{
			if(units == 15 || units == 30 || units == 45 || units == 60)
			{
			if(moveSidePos == 0){cutPosX = 2200;}
			if(moveSidePos == 1){cutPosX = 2400;}
			if(moveSidePos == 2){cutPosX = 2600;}
			if(moveSidePos == 3){cutPosX = 2400;}
			moveSidePos++;
			if(moveSidePos == 4)
			{moveSidePos = 0;}
			}
			units = units - 5;
			posX = posX - 7.5;
			
			if (posX < 0)
			{
				// If at edge, reset char position and set flag.
				posX = 0;
				flag = 1;
			}
			if(!(flag))
		  {
			resetChar();
		  }
			
		}
		
		// Right arrow
		if(caseNumbers == 39)
		{
			if(units == 15 || units == 30 || units == 45 || units == 60)
			{
			if(moveSidePos == 0){cutPosX = 1400;}
			if(moveSidePos == 1){cutPosX = 1600;}
			if(moveSidePos == 2){cutPosX = 1800;}
			if(moveSidePos == 3){cutPosX = 1600;}
			moveSidePos++;
			if(moveSidePos == 4)
			{moveSidePos = 0;}
			}
			units = units - 5;
			posX = posX + 7.5;
			
			  if (posX > 1210) {
				// If at edge, reset char position and set flag.
				posX = 1170;
				flag = 1;
			  }
			  if(!(flag))
		  {
			resetChar();
		  }
			  
		}
		
		//Down arrow
		if(caseNumbers == 40)
		{
			units = units - 5;
			posY = posY + 7.5;
			if(units == 15 || units == 30 || units == 45 || units == 60)
			{
			if(movePos == 0){cutPosX = 200;}
			if(movePos == 1){cutPosX = 400;}
			movePos++;
			if(movePos == 2)
			{movePos = 0;}
			}
          if (posY > 615) {
            // If at edge, reset ship position and set flag.
            posY = 600;
            flag = 1;
          }
		  if(!(flag))
		  {
			resetChar();
		  }
		}
		
		//Up arrow
		if(caseNumbers == 38)
		{
			units = units - 5;
			posY = posY - 7.5;
			if(units == 15 || units == 30 || units == 45 || units == 60)
			{
			if(movePos == 0){cutPosX = 800;}
			if(movePos == 1){cutPosX = 1000;}
			movePos++;
			if(movePos == 2)
			{movePos = 0;}
			}
          if (posY < 0) {
            // If at edge, reset ship position and set flag.
            posY = 0;
            flag = 1;
          }
		  if(!(flag))
		  {
			resetChar();
		  }
		}
		
		//transition
		if(caseNumbers == 200)
		{
			if(transition == 1)
			{
				units = units - 3;
				transitionX = transitionX + 128;
				context.clearRect ( 0 , 0 , canvas.width, canvas.height );
				context.drawImage(transitionImage,transitionX,0,1280,720);
			}
			else {
				context.clearRect ( 0 , 0 , canvas.width, canvas.height );
				transition = 0;
				if(battle == 0)
				{
					battle = 1;
				}
				else {
					battle = 0;
				}
			}
		}
	}	
	if (flag)
	{
          posX = oldCharX;
          posY = oldCharY;
    }
		
	if(units == 0 && moving == 1)
	{
		moving = 0;
		transition = 0;
		if(caseNumbers == 37 || caseNumbers == 38 || caseNumbers == 39 || caseNumbers == 40)
		{
			footstep.play();
		}
	}
	
}	  
	  
function draw()
{
if(roam == 1)
{
context.clearRect ( 0 , 0 , canvas.width, canvas.height );
context.drawImage(background,0,0,1280,720);
if(door == 1)
{
	context.drawImage(npc1, npc1PosX, npc1PosY, 50, 50);
}
context.drawImage(npc2, npc2PosX, npc2PosY, 50, 50);
context.drawImage(base_image, cutPosX, cutPosY, cutWidthX, 300, posX, posY, 70, 105);
}
}

function resetChar()
{
	if(charReset)
	{
		clearTimeout(charReset);
	}
	charReset = setTimeout(function(){cutPosX = 0;	cutWidthX = 200;},700);
}

function alertBox(str)
{
	alert(str);
}

function game_canvas() {
	
}
</script>

</body>
</html>
